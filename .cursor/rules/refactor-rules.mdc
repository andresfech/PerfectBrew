---
alwaysApply: false
triggerPhrases:
  - "refactor"
  - "refactoring"
  - "restructure"
  - "reorganize"
  - "clean up code"
  - "improve structure"
---

# Code & Documentation Refactoring Rules

## ğŸ¯ Goal: Safely refactor existing codebase or large documentation

## ğŸ“ PerfectBrew Architecture
- **Frontend**: iOS SwiftUI app with MVVM pattern
- **Models**: Recipe.swift, RecipeDatabase.swift
- **ViewModels**: BrewingGuideViewModel.swift
- **Services**: AudioService.swift, LocalizationManager.swift, SettingsManager.swift
- **Resources**: JSON recipe files (AeroPress, V60, FrenchPress)
- **Audio**: Chatterbox TTS integration for step-by-step narration
- **Storage**: Local JSON files + Core Data for brew history
- **Views**: BrewingGuideScreen.swift, HomeScreen.swift, RecipeSelectionScreen.swift
- **Animations**: Lottie animations for brewing process

## ğŸ§© Required Components
- **Current State Analysis** â€“ What exists now and why it needs refactoring
- **Refactor Goals** â€“ Clear objectives (readability, performance, maintainability)
- **Before/After Structure** â€“ Specific file organization changes
- **Safety Strategy** â€“ Git commits, rollback plan, testing approach
- **Old File Cleanup Plan** â€“ How to handle deprecated files
- **QA Strategy** â€“ How to verify refactor didn't break functionality

## ğŸ›  Step 1: Pre-Refactor Analysis
- **Scope Definition** â€“ What files/sections need refactoring?
- **Current Problems** â€“ Why is refactoring needed?
- **Dependencies** â€“ What other code/docs depend on this?
- **Breaking Changes** â€“ Will this affect other systems?
- **Git Strategy** â€“ Commit checkpoints and rollback plan
- **Testing Plan** â€“ How to verify no functionality is lost

## ğŸ§­ Step 2: Refactor Plan Components
- **Goals** â€“ What we're improving and why
- **File Changes** â€“ Specific files to modify/split/merge
- **Structure Changes** â€“ New organization pattern
- **Migration Steps** â€“ Ordered sequence of changes
- **Validation Points** â€“ How to verify each step
- **Rollback Plan** â€“ How to undo if something breaks

## ğŸ“‹ Step 3: PerfectBrew-Specific Considerations
- **Recipe JSON Structure** â€“ Maintain backward compatibility
- **Audio File Organization** â€“ Preserve existing audio paths
- **SwiftUI View Hierarchy** â€“ Keep MVVM pattern intact
- **Timer Logic** â€“ Ensure brewing timing remains accurate
- **Audio Synchronization** â€“ Maintain step-to-audio mapping
- **User Experience** â€“ Preserve existing UI/UX patterns

## ğŸ¯ Trigger Phrases
This rule activates when user mentions:
- "refactor"
- "refactoring"
- "restructure"
- "reorganize"
- "clean up code"
- "improve structure"